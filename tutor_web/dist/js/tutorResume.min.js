!function(){Vue.http.interceptors.push(function(t,e){t.credentials=!0,e()});new Vue({el:"body",data:{domain:"http://www.yinzishao.cn",timer:null,hintData:{status:!1,text:""},status:{isSubmit:!1,isLoading:!1,isUploadImg:!0,isPrice:!1,isNotice:!1,isSelected:!0},salary:"",notice:"",Arr:{gradeArr:[],subjectArr:[],teacher_method_arr:[]},location:{latitude:"",longitude:""},images:{certificate_photo:"",teach_show_photo:[{img:""},{img:""},{img:""}]},signature:"",form:{name:"",qualification:1,number:"",sex:1,native_place:"",campus_major:"",tel:"",grade:"",subject:"",subject_other:"",place:"",teacher_method:"",self_comment:"",salary_bottom:Number,salary_top:Number,score:"",certificate_photo:"",teach_show_photo:[{img:""},{img:""},{img:""}],teacher_method_other:"",mon_begin:"",mon_end:"",tues_begin:"",tues_end:"",wed_begin:"",wed_end:"",thur_begin:"",thur_end:"",fri_begin:"",fri_end:"",sat_morning:0,sat_afternoon:0,sat_evening:0,sun_morning:0,sun_afternoon:0,sun_evening:0},time:{Mon:[],Tue:[],Wed:[],Thr:[],Fri:[]},formGroup:[{value:[{key:"Mon",tag:"周一",begin:"mon_begin",end:"mon_end"},{key:"Tue",tag:"周二",begin:"tues_begin",end:"tues_end"},{key:"Wed",tag:"周三",begin:"wed_begin",end:"wed_end"},{key:"Thr",tag:"周四",begin:"thur_begin",end:"thur_end"},{key:"Fri",tag:"周五",begin:"fri_begin",end:"fri_end"}]},{value:{Sat:{tag:"周六",key:[{tag:"sat_morning"},{tag:"sat_afternoon"},{tag:"sat_evening"}]},Sun:{tag:"周日",key:[{tag:"sun_morning"},{tag:"sun_afternoon"},{tag:"sun_evening"}]}}},{value:[{tag:"数学"},{tag:"语文"},{tag:"英语"},{tag:"物理"},{tag:"化学"},{tag:"生物"},{tag:"奥数"},{tag:"音乐"},{tag:"美术"},{tag:"全科"},{tag:"其他"}]},{value:[{tag:"小学1年级"},{tag:"小学2年级"},{tag:"小学3年级"},{tag:"小学4年级"},{tag:"小学5年级"},{tag:"小学6年级"},{tag:"初中1年级"},{tag:"初中2年级"},{tag:"初中3年级"},{tag:"高中1年级"},{tag:"高中2年级"},{tag:"高中3年级"},{tag:"大学辅导"},{tag:"成人辅导"}]}]},computed:{isOtherMethod:function(){for(var t=0,e=this.Arr.teacher_method_arr.length;t<e;t++)if("其他"==this.Arr.teacher_method_arr[t])return!0;return!1},isOtherSubject:function(){for(var t=0,e=this.Arr.subjectArr.length;t<e;t++)if("其他"==this.Arr.subjectArr[t])return!0;return!1}},watch:{"Arr.gradeArr":function(t){t.length>1?this.form.grade=t.join(","):this.form.grade=t[0]},"Arr.subjectArr":function(t){t.length>1?this.form.subject=t.join(","):this.form.subject=t[0]},"Arr.teacher_method_arr":function(t){t.length>1?this.form.teacher_method=t.join(","):this.form.teacher_method=t[0]}},ready:function(){if(this.getSignature(),this.getParam())this.render();else{var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.onGetLocation()},300)}this.status.isLoading=!0},methods:{getData:function(t){this.$http.post(this.domain+"/getText",{key:[t]},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(e){console.log(e.json()),1==e.json().success?"salary"==t?this.salary=e.json().salary:this.notice=e.json().notice:console.log(e.json().error)})},offHint:function(){this.hintData.status=!1},getParam:function(){var t=location.search;return t.indexOf("?")==-1?0:1},render:function(){this.$http.post(this.domain+"/getTeacherInfo",{format:0},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){console.log(t.json());var e=t.json();delete e.tea_id,this.$set("form",e);var i=t.json().certificate_photo;""!==i&&(this.images.certificate_photo=this.domain+i);for(var o=t.json().teach_show_photo,n=0;n<3;n++)if(""!=o[n].img){var s=o[n].img;o[n].img=this.domain+s}this.images.teach_show_photo=o,this.form.salary_bottom=parseInt(t.json().salary_bottom),this.form.salary_top=parseInt(t.json().salary_top);var a=this.form.subject,r=this.form.grade,h=this.form.teacher_method,c=this.form.mon_end,u=this.form.tues_end,g=this.form.wed_end,m=this.form.thur_end,f=this.form.fri_end;null!==a&&""!==a&&this.getArr(a,"subjectArr"),null!==r&&""!==r&&this.getArr(r,"gradeArr"),null!==h&&""!==h&&this.getArr(h,"teacher_method_arr"),null!==c&&""!==c&&this.getTimePeriod("mon_begin",c,"Mon"),null!==u&&""!==u&&this.getTimePeriod("tues_begin",u,"Tue"),null!==g&&""!==g&&this.getTimePeriod("wed_begin",g,"Wed"),null!==m&&""!==m&&this.getTimePeriod("thur_begin",m,"Thr"),null!==f&&""!==f&&this.getTimePeriod("fri_begin",f,"Fri")})},getArr:function(t,e){t.indexOf(",")==-1?this.Arr[e].push(t):this.Arr[e]=t.split(",")},getTimePeriod:function(t,e,i){for(var o=this.form[t];o<=e;o++)this.time[i].push(o)},addInput:function(){var t={key:""};this.form.score_other.push(t)},onWeekday:function(t,e,i,o){var n=this.time,s=this.form;if(0==n[t].length&&(s[i]=e,s[o]=e),n[t].length>=1)if(e>s[o]){s[o]=e,n[t]=[];for(var a=s[i];a<s[o];a++)n[t].push(a)}else if(e>s[i]&&e<s[o]){s[o]=e,n[t]=[];for(var a=s[i];a<s[o];a++)n[t].push(a)}else if(e==s[i]){s[o]=s[i],n[t]=[];for(var a=s[i];a<=s[o];a++)n[t].push(a);s[i]="",s[o]=""}else if(e<s[i]&&s[i]<s[o]){s[i]=e,n[t]=[];for(var a=s[i]+1;a<=s[o];a++)n[t].push(a)}},zero:function(t){return t<10?"0"+t:t},onSubmit:function(){var t,e=this.getParam(),i=this;return t=0==e?"/createTeacher":"/updateTeacher",/^1[34578]\d{9}$/.test(this.form.tel)?(this.hintData.text="",this.status.isSubmit=!0,i.onSubmitPost(t),void 0):(this.hintData.status=!0,this.hintData.text="请填写正确的手机号码",!1)},onSubmitPost:function(t){var e,i=this;this.$http.post(this.domain+t,this.form,{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(o){this.status.isSubmit=!1,console.log(o.json()),1==o.json().success?(this.hintData.text="成功提交，请耐心等待审核",this.hintData.status=!0,"/createTeacher"==t?(this.getData("notice"),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.hintData.status=!1,i.status.isNotice=!0},1e3)):(e="./teacherMyPage.html",this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.hintData.status=!1,location.href=e},2e3))):(this.hintData.text=o.json().error,this.hintData.status=!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.hintData.status=!1},2e3))})},onNotice:function(){location.href="teacherPage.html"},uploadImg:function(t){var e=this.images,i=this;wx.ready(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){console.log(o);var n=o.localIds[0];"certificate_photo"==t?e.certificate_photo=n:e.teach_show_photo[t].img=n,i.uploadImgTo(n,t)}})})},uploadImgTo:function(t,e){var i,o=this.form;wx.uploadImage({localId:t,isShowProgressTips:1,success:function(t){i=t.serverId,"certificate_photo"==e?o.certificate_photo=i:o.teach_show_photo[e].img=i}})},onClosePrice:function(){this.status.isPrice=!1},onCloseNotice:function(){this.status.isNotice=!1},onSalary:function(){this.getData("salary"),this.status.isPrice=!0},getSignature:function(){this.$http.post(this.domain+"/generate_signature",{timestamp:1482652615,nonceStr:"yinzishao"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){console.log(t.json()),this.signature=t.json().signature;var e=this;wx.config({debug:!1,appId:"wx6fe7f0568b75d925",timestamp:1482652615,nonceStr:"yinzishao",signature:e.signature,jsApiList:["checkJsApi","openLocation","getLocation","chooseImage","uploadImage"]})})},onGetLocation:function(){var t=this;wx.ready(function(){wx.getLocation({type:"wgs84",success:function(e){t.location.latitude=e.latitude,t.location.longitude=e.longitude,t.onAllow()}})})},onAllow:function(){this.$http.post(this.domain+"/setLocations",this.location,{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){1==t.json().success})}}})}();