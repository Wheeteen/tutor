!function(){Vue.http.interceptors.push(function(s,t){s.credentials=!0,t()});new Vue({el:"body",data:{timer:null,domain:"http://shaozi.beansonbar.cn",msgList:[],status:{isList:!0,isNoList:!1,isLoading:!0,isTutorInfo:!1,isInvited:!0,isReject:!1,isSureRefuse:!1,isSureAccept:!1,isAccount:!1,isUploadImg:!1,isRemindTip:!1,text:"",isSuccess:!0,expection:!1,isSubmit:!1,isEnlargeImg:!1,enlargeImg:"",overY:!1},detailedList:[],signature:"",form:{selected:"",isRegister:"",expection:"",isMsg:"",img:"",serverId:""},para:{start:0,size:16},jsonData:[],config:{width:100,height:100,quality:.8}},computed:{remindSubmit:function(){return""!==this.form.expection&&null!=this.form.expection},isOnSubmit:function(){return""!=this.form.serverId}},ready:function(){this.renderData(),this.status.isLoading=!1},methods:{down:function(){this.para.size=5,this.para.start++,0!==this.jsonData.length&&this.renderData()},renderData:function(){this.$http.post(this.domain+"/getOrder",this.para,{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(console.log(s.json()),0==s.json().success)console.log(s.json().error);else{this.jsonData=s.json();var t=s.json();if(0!=t.length){for(var i=0;i<t.length;i++)"您已拒绝"==t[i].result||"家长已拒绝"==t[i].result||"您未按时上传截图"==t[i].result?t[i].isRed=!0:t[i].isRed=!1,null==t[i].screenshot_path&&""==t[i].screenshot_path||(t[i].screenshot_path=this.domain+t[i].screenshot_path);var e=this.msgList.concat(t);this.$set("msgList",e)}else 0==this.msgList.length&&(this.status.isList=!1,this.status.isNoList=!0)}})},getSignature:function(){this.$http.post(this.domain+"/generate_signature",{timestamp:1482652615,nonceStr:"yinzishao"},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){console.log(s.json()),this.signature=s.json().signature;var t=this;wx.config({debug:!1,appId:"wx7a327445ac3309b4",timestamp:1482652615,nonceStr:"yinzishao",signature:t.signature,jsApiList:["chooseImage","uploadImage"]})})},onReturn:function(){window.location.href="./teacherMyPage.html"},grade_level:function(s){switch(s){case 0:return"";case 1:return"较为靠后";case 2:return"中等偏下";case 3:return"中等水平";case 4:return"中上水平";case 5:return"名列前茅"}},onTutorInfo:function(s){this.status.overY=!0,this.form.selected=s,this.status.isTutorInfo=!0,this.status.isSuccess=!0;var t=this.msgList[s];"请上传截图"==t.result?(""==this.signature&&this.getSignature(),this.status.isTutorInfo=!1,this.status.isAccount=!0):"对方已同意"==t.result?(this.status.isTutorInfo=!1,this.onAccept(s)):"管理员审核中"==t.result?(this.status.isTutorInfo=!1,this.status.isRemindTip=!0):(this.$http.post(this.domain+"/getParentInfo",{pd_id:t.pd,format:!0},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(s){if(console.log(s.json()),0==s.json().success)console.log(s.json().error);else{var t=s.json();t.class_field=this.grade_level(t.class_field),this.detailedList=t}}),"对方已邀请"==t.result?(this.status.isInvited=!0,this.status.isReject=!1):"已成交"==t.result?(this.status.text="双方已成交",this.status.isInvited=!1,this.status.isReject=!0):"家长已拒绝"==t.result?(this.status.text="再次报名该家长",this.status.isInvited=!1,this.status.isReject=!0):"您已拒绝"==t.result?(this.status.text="您已拒绝邀请",this.status.isInvited=!1,this.status.isReject=!0,this.status.isSuccess=!1):"您未按时上传截图"==t.result?(this.status.text="您未按时上传截图",this.status.isInvited=!1,this.status.isReject=!0,this.status.isSuccess=!1):"您已报名"==t.result&&(this.status.text="取消报名",this.status.isInvited=!1,this.status.isReject=!0,this.status.isSuccess=!1))},onStep:function(s){"再次报名该家长"==this.status.text?(this.status.isTutorInfo=!1,this.status.expection=!0):"取消报名"==this.status.text?(this.status.isTutorInfo=!1,this.form.isMsg="取消报名",this.status.isSureRefuse=!0):"双方已成交"!=this.status.text&&"您已拒绝邀请"!=this.status.text&&"您未按时上传截图"!=this.status.text||(this.status.isTutorInfo=!1,this.status.overY=!1)},onApply:function(s){return""!=this.form.expection&&null!=this.form.expection&&void this.$http.post(this.domain+"/applyParent",{pd_id:this.msgList[s].pd,expectation:this.form.expection,type:1},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(console.log(t.json()),this.status.overY=!1,1==t.json().success){var i=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.msgList[s].result="您已报名",i.msgList[s].isRed=!1,i.msgList[s].finish=0,i.status.expection=!1,i.form.expection=""},1e3)}})},onAccept:function(s){this.$http.post(this.domain+"/handleOrder",{accept:1,id:this.msgList[s].pd,type:0},{crossOrigin:!0,headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(t){this.status.overY=!1,1==t.json().success?(""==this.signature&&this.getSignature(),this.msgList[s].finish=0,this.msgList[s].isRed=!1,this.msgList[s].result="请上传截图",this.status.isTutorInfo=!1,this.status.isAccount=!0):console.log(t.json().error)})},onRefuse:function(){this.status.overY=!1,this.form.isMsg="拒绝邀请",this.status.isTutorInfo=!1,this.status.isSureRefuse=!0},onCloseExp:function(){this.status.overY=!1,this.status.expection=!1},onSureRefuse:function(s){var t=this.form.isMsg;"取消报名"==t?this.$http.post(this.domain+"/applyParent",{pd_id:this.msgList[s].pd,type:0},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){if(this.status.overY=!1,console.log(t.json()),1==t.json().success){var i=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.status.isSureRefuse=!1,i.msgList.splice(s,1)},500)}else conosle.log(t.json().error)}):this.$http.post(this.domain+"/handleOrder",{accept:0,id:this.msgList[s].pd,type:0},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){this.status.overY=!1,1==t.json().success?(this.msgList[s].result="您已拒绝",this.msgList[s].isRed=!0,this.msgList[s].finish=1,this.status.isSureRefuse=!1,this.status.isTutorInfo=!1):console.log(t.json().error)})},onChangeImg:function(){""==this.signature&&this.getSignature(),this.status.isRemindTip=!1,this.status.isAccount=!0},onCancel:function(){this.status.overY=!1,this.status.isSureRefuse=!1},onClose:function(){this.status.overY=!1,this.status.isTutorInfo=!1},onCloseAccount:function(){this.status.overY=!1,this.status.isAccount=!1},uploadImg:function(){var s=this;wx.ready(function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){console.log(t);var i=t.localIds[0];s.form.img=i,s.uploadImgTo(i)}})})},uploadImgTo:function(s){var t=this;wx.uploadImage({localId:s,isShowProgressTips:1,success:function(s){t.form.serverId=s.serverId}})},onSubmitImg:function(s){return""!=this.form.serverId&&void this.$http.post(this.domain+"/uploadScreenshot",{oa_id:this.msgList[s].oa_id,pic:this.form.serverId},{crossOrigin:!0,headers:{"Content-Type":"application/json"}}).then(function(t){console.log(t.json()),1==t.json().success?(this.status.isAccount=!1,this.status.isRemindTip=!0,this.msgList[s].isRed=!1,this.msgList[s].screenshot_path=this.form.img,this.form.img="",this.form.serverId="",this.msgList[s].result="管理员审核中"):console.log(t.json().error)})},showImg:function(s){this.status.enlargeImg=this.msgList[this.form.selected].screenshot_path,this.status.isEnlargeImg=!0},closeImg:function(){this.status.isEnlargeImg=!1},onSureSubmit:function(s){this.status.overY=!1,this.status.isRemindTip=!1}}})}();